{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prolewiki.org/schemas/training/manifest.schema.json",
  "title": "Marxist-GRPO Dataset Manifest",
  "description": "Schema for the dataset manifest tracking all training data files, their provenance, and aggregate statistics. This manifest enables reproducible ML research by documenting exactly what data was used in each training iteration.",
  "type": "object",
  "required": [
    "manifest_version",
    "dataset",
    "files",
    "statistics",
    "provenance"
  ],
  "properties": {
    "manifest_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Semantic version of the manifest schema.",
      "examples": [
        "1.0.0"
      ]
    },
    "dataset": {
      "$ref": "#/$defs/datasetInfo"
    },
    "files": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/fileEntry"
      },
      "minItems": 1,
      "description": "List of all JSONL files in the dataset."
    },
    "statistics": {
      "$ref": "#/$defs/statistics"
    },
    "provenance": {
      "$ref": "#/$defs/manifestProvenance"
    },
    "training_iterations": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/trainingIteration"
      },
      "description": "History of training iterations using this dataset."
    },
    "known_issues": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/knownIssue"
      },
      "description": "Documented issues with the dataset that users should be aware of."
    },
    "changelog": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/changelogEntry"
      },
      "description": "History of changes to the dataset."
    }
  },
  "additionalProperties": false,
  "$defs": {
    "datasetInfo": {
      "type": "object",
      "description": "Core dataset identification and description.",
      "required": [
        "name",
        "version",
        "description",
        "license"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable dataset name."
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "Semantic version of the dataset."
        },
        "description": {
          "type": "string",
          "description": "Brief description of the dataset's purpose and contents."
        },
        "license": {
          "type": "string",
          "description": "License under which the dataset is released.",
          "examples": [
            "CC-BY-SA-4.0",
            "MIT",
            "Apache-2.0"
          ]
        },
        "homepage": {
          "type": [
            "string",
            "null"
          ],
          "format": "uri",
          "description": "URL to dataset homepage or documentation."
        },
        "repository": {
          "type": [
            "string",
            "null"
          ],
          "format": "uri",
          "description": "URL to source code repository."
        },
        "citation": {
          "type": [
            "string",
            "null"
          ],
          "description": "How to cite this dataset in academic work."
        },
        "intended_use": {
          "type": "string",
          "description": "Intended use cases for this dataset."
        },
        "limitations": {
          "type": "string",
          "description": "Known limitations of the dataset."
        }
      },
      "additionalProperties": false
    },
    "fileEntry": {
      "type": "object",
      "description": "Metadata for a single JSONL file in the dataset.",
      "required": [
        "filename",
        "record_count",
        "sha256",
        "purpose"
      ],
      "properties": {
        "filename": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_-]+\\.jsonl$",
          "description": "Filename relative to training_data/ directory."
        },
        "record_count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of records (lines) in the file."
        },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of file contents for integrity verification."
        },
        "purpose": {
          "type": "string",
          "description": "What this file contains and why it exists."
        },
        "source_type": {
          "type": "string",
          "enum": [
            "prolewiki",
            "synthetic",
            "curated",
            "library",
            "external",
            "mixed"
          ],
          "description": "Primary source type of records in this file."
        },
        "iteration_added": {
          "type": "integer",
          "minimum": 1,
          "description": "Which training iteration this file was added in."
        },
        "categories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Primary categories covered by this file."
        },
        "schema_compliant": {
          "type": "boolean",
          "description": "Whether all records pass schema validation."
        },
        "human_reviewed": {
          "type": "boolean",
          "description": "Whether records have been human-reviewed."
        },
        "include_in_training": {
          "type": "boolean",
          "default": true,
          "description": "Whether to include this file in training runs."
        },
        "notes": {
          "type": [
            "string",
            "null"
          ],
          "description": "Additional notes about this file."
        }
      },
      "additionalProperties": false
    },
    "statistics": {
      "type": "object",
      "description": "Aggregate statistics across all files.",
      "required": [
        "total_records",
        "total_files"
      ],
      "properties": {
        "total_records": {
          "type": "integer",
          "minimum": 0,
          "description": "Total Q&A pairs across all files."
        },
        "total_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of JSONL files."
        },
        "by_source_type": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "description": "Record counts by source type."
        },
        "by_tradition": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "description": "Record counts by theoretical tradition."
        },
        "by_category": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "description": "Record counts by category (top categories)."
        },
        "by_difficulty": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "description": "Record counts by difficulty level."
        },
        "by_iteration": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "description": "Record counts by training iteration."
        },
        "avg_instruction_length": {
          "type": "number",
          "description": "Average instruction length in characters."
        },
        "avg_response_length": {
          "type": "number",
          "description": "Average response length in characters."
        },
        "human_verified_count": {
          "type": "integer",
          "description": "Number of human-verified records."
        },
        "cited_authors_unique": {
          "type": "integer",
          "description": "Number of unique authors cited across all records."
        }
      },
      "additionalProperties": false
    },
    "manifestProvenance": {
      "type": "object",
      "description": "Manifest file provenance.",
      "required": [
        "generated_date",
        "generated_by"
      ],
      "properties": {
        "generated_date": {
          "type": "string",
          "format": "date-time",
          "description": "When this manifest was generated."
        },
        "generated_by": {
          "type": "string",
          "description": "Tool or person that generated this manifest."
        },
        "last_validated": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "When all files were last validated against schema."
        },
        "validation_tool_version": {
          "type": [
            "string",
            "null"
          ],
          "description": "Version of validation tool used."
        }
      },
      "additionalProperties": false
    },
    "trainingIteration": {
      "type": "object",
      "description": "Record of a training iteration.",
      "required": [
        "iteration",
        "date",
        "description"
      ],
      "properties": {
        "iteration": {
          "type": "integer",
          "minimum": 1,
          "description": "Iteration number."
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of training."
        },
        "description": {
          "type": "string",
          "description": "What this iteration addressed."
        },
        "base_model": {
          "type": "string",
          "description": "Base model used."
        },
        "method": {
          "type": "string",
          "description": "Training method (SFT, GRPO, DPO, etc.)."
        },
        "files_used": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Which files were included in training."
        },
        "records_used": {
          "type": "integer",
          "description": "Total records used in this iteration."
        },
        "output_model": {
          "type": [
            "string",
            "null"
          ],
          "description": "Name/path of resulting model."
        },
        "wandb_run": {
          "type": [
            "string",
            "null"
          ],
          "format": "uri",
          "description": "Weights & Biases run URL if applicable."
        },
        "notes": {
          "type": [
            "string",
            "null"
          ],
          "description": "Additional notes about this iteration."
        }
      },
      "additionalProperties": false
    },
    "knownIssue": {
      "type": "object",
      "description": "A documented issue with the dataset.",
      "required": [
        "id",
        "severity",
        "description"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique issue identifier."
        },
        "severity": {
          "type": "string",
          "enum": [
            "critical",
            "high",
            "medium",
            "low"
          ],
          "description": "Issue severity."
        },
        "description": {
          "type": "string",
          "description": "Description of the issue."
        },
        "affected_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Files affected by this issue."
        },
        "discovered_date": {
          "type": "string",
          "format": "date",
          "description": "When the issue was discovered."
        },
        "resolved_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date",
          "description": "When the issue was resolved (null if open)."
        },
        "resolution": {
          "type": [
            "string",
            "null"
          ],
          "description": "How the issue was resolved."
        }
      },
      "additionalProperties": false
    },
    "changelogEntry": {
      "type": "object",
      "description": "A changelog entry for dataset modifications.",
      "required": [
        "date",
        "version",
        "changes"
      ],
      "properties": {
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of changes."
        },
        "version": {
          "type": "string",
          "description": "Dataset version after changes."
        },
        "changes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of changes made."
        }
      },
      "additionalProperties": false
    }
  }
}
