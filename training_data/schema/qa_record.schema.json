{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prolewiki.org/schemas/training/qa_record.schema.json",
  "title": "ProleWiki Q&A Training Record",
  "description": "Schema for Q&A training records aligned with ChromaDB pw_schema. Each record represents an instruction-response pair with provenance metadata that links back to the source corpus.",
  "type": "object",
  "required": [
    "qa_id",
    "instruction",
    "response",
    "source",
    "classification",
    "provenance"
  ],
  "properties": {
    "qa_id": {
      "type": "string",
      "pattern": "^(Main|Library|Essays|ProleWiki|Training)/[^#]+#[0-9]{3,}$",
      "description": "Unique identifier matching ChromaDB chunk ID format: {namespace}/{title}#{index}",
      "examples": [
        "Library/Lenin_Revisionism#001",
        "Library/Jackson_Blood_My_Eye#015",
        "Training/Synthetic_Antisemitism#042"
      ]
    },
    "instruction": {
      "type": "string",
      "minLength": 10,
      "maxLength": 2000,
      "description": "The question or prompt presented to the model during training."
    },
    "response": {
      "type": "string",
      "minLength": 50,
      "maxLength": 15000,
      "description": "The target response the model should learn to generate."
    },
    "source": {
      "$ref": "#/$defs/source"
    },
    "classification": {
      "$ref": "#/$defs/classification"
    },
    "quality": {
      "$ref": "#/$defs/quality"
    },
    "provenance": {
      "$ref": "#/$defs/provenance"
    },
    "training": {
      "$ref": "#/$defs/training"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "source": {
      "type": "object",
      "description": "Source provenance aligned with ChromaDB pw_schema chunk metadata.",
      "required": [
        "namespace"
      ],
      "properties": {
        "namespace": {
          "type": "string",
          "enum": [
            "Main",
            "Library",
            "Essays",
            "ProleWiki",
            "Training"
          ],
          "description": "Content namespace (matches ChromaDB pw_schema.chunk_metadata.namespace). Training namespace used for synthetic data."
        },
        "article_title": {
          "type": [
            "string",
            "null"
          ],
          "description": "Source article or work title (matches pw_schema.chunk_metadata.article_title).",
          "examples": [
            "Marxism and Revisionism",
            "Blood in My Eye",
            "The Wretched of the Earth"
          ]
        },
        "author": {
          "type": [
            "string",
            "null"
          ],
          "description": "Primary author of the source material.",
          "examples": [
            "Vladimir Lenin",
            "George Jackson",
            "Frantz Fanon"
          ]
        },
        "work": {
          "type": [
            "string",
            "null"
          ],
          "description": "Full title of the source work (may differ from article_title for Library works)."
        },
        "section": {
          "type": [
            "string",
            "null"
          ],
          "description": "Section within the source work (matches pw_schema.chunk_metadata.section)."
        },
        "line_range": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[0-9]+-[0-9]+$",
          "description": "Line range in source file for citation (matches pw_schema.chunk_metadata.line_range).",
          "examples": [
            "45-52",
            "1-20"
          ]
        },
        "chunk_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^(Main|Library|Essays|ProleWiki)/[^#]+#[0-9]+$"
          },
          "description": "ChromaDB chunk IDs this Q&A was derived from (links to RAG corpus)."
        },
        "url": {
          "type": [
            "string",
            "null"
          ],
          "format": "uri",
          "description": "URL to original source if externally derived."
        }
      },
      "additionalProperties": false
    },
    "classification": {
      "type": "object",
      "description": "Theoretical and topical classification.",
      "required": [
        "categories",
        "tradition"
      ],
      "properties": {
        "categories": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 2
          },
          "minItems": 1,
          "uniqueItems": true,
          "description": "Topic tags aligned with ProleWiki categories (matches pw_schema.chunk_metadata.categories).",
          "examples": [
            [
              "revisionism",
              "marxist-theory"
            ],
            [
              "anti-zionism",
              "settler-colonialism",
              "national-liberation"
            ]
          ]
        },
        "tradition": {
          "type": "string",
          "enum": [
            "ML",
            "MLM",
            "general",
            "contested"
          ],
          "description": "Marxist tradition. ML=Marxism-Leninism, MLM=Marxism-Leninism-Maoism, general=broadly applicable, contested=debated."
        },
        "subtradition": {
          "type": [
            "string",
            "null"
          ],
          "description": "More specific tendency if applicable.",
          "examples": [
            "Hoxhaist",
            "Third-Worldist",
            "Decolonial"
          ]
        },
        "historical_period": {
          "type": [
            "string",
            "null"
          ],
          "description": "Historical period if period-specific.",
          "examples": [
            "Russian Revolution",
            "Cultural Revolution",
            "Cold War",
            "Second International"
          ]
        },
        "geographic_focus": {
          "type": [
            "string",
            "null"
          ],
          "description": "Geographic region if region-specific.",
          "examples": [
            "Soviet Union",
            "China",
            "Palestine",
            "Africa",
            "United States"
          ]
        }
      },
      "additionalProperties": false
    },
    "quality": {
      "type": "object",
      "description": "Quality assessment aligned with pw_schema quality flags.",
      "properties": {
        "is_stub": {
          "type": "boolean",
          "default": false,
          "description": "Source marked as incomplete (matches pw_schema.chunk_metadata.is_stub)."
        },
        "citation_needed_count": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Number of claims needing citation (matches pw_schema.chunk_metadata.citation_needed_count)."
        },
        "has_blockquote": {
          "type": "boolean",
          "default": false,
          "description": "Contains primary source quotation (matches pw_schema.chunk_metadata.has_blockquote)."
        },
        "human_verified": {
          "type": "boolean",
          "default": false,
          "description": "Whether a human has verified this Q&A for accuracy."
        },
        "confidence": {
          "type": "string",
          "enum": [
            "high",
            "medium",
            "low"
          ],
          "default": "medium",
          "description": "Confidence level in the response accuracy."
        },
        "notes": {
          "type": [
            "string",
            "null"
          ],
          "description": "Any notes about quality issues or caveats."
        },
        "flagged_issues": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Known issues with this record that need attention."
        }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "description": "Record creation and modification tracking.",
      "required": [
        "created_date",
        "created_by"
      ],
      "properties": {
        "created_date": {
          "type": "string",
          "format": "date",
          "description": "ISO 8601 date when this record was created."
        },
        "created_by": {
          "type": "string",
          "enum": [
            "human",
            "claude-opus",
            "claude-sonnet",
            "other-llm",
            "automated"
          ],
          "description": "Who/what created this record."
        },
        "reviewed_by": {
          "type": [
            "string",
            "null"
          ],
          "description": "Human reviewer if applicable."
        },
        "review_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date",
          "description": "Date of human review."
        },
        "modified_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date",
          "description": "Last modification date if edited after creation."
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Version number of this record (incremented on edits)."
        }
      },
      "additionalProperties": false
    },
    "training": {
      "type": "object",
      "description": "Training-specific metadata for GRPO fine-tuning.",
      "properties": {
        "iteration": {
          "type": "integer",
          "minimum": 1,
          "description": "Which training iteration this record was added in."
        },
        "correction_for": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "cpc-contamination",
              "both-sidesing",
              "hallucination",
              "antisemitism-conflation",
              "liberal-framing",
              "historical-inaccuracy",
              "theoretical-error",
              "accommodation",
              "extended-engagement",
              "chatbot-mode",
              "saccharine-language"
            ]
          },
          "description": "What failure modes this record is designed to correct."
        },
        "difficulty": {
          "type": "string",
          "enum": [
            "basic",
            "intermediate",
            "advanced",
            "adversarial"
          ],
          "description": "Difficulty level of the question."
        },
        "response_style": {
          "type": "string",
          "enum": [
            "educational",
            "firm-rejection",
            "theoretical",
            "historical",
            "biographical",
            "analytical",
            "comparative",
            "practical"
          ],
          "description": "The style/pattern of the response."
        },
        "adversarial_type": {
          "type": [
            "string",
            "null"
          ],
          "enum": [
            null,
            "bad-faith-question",
            "conspiracy-premise",
            "incremental-shift",
            "false-equivalence",
            "appeal-to-complexity"
          ],
          "description": "For adversarial questions, what type of adversarial pattern."
        }
      },
      "additionalProperties": false
    }
  }
}
