{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prolewiki.org/schemas/training/record.schema.json",
  "title": "Marxist-GRPO Training Record",
  "description": "Schema for individual Q&A training records in the Marxist-Leninist GRPO fine-tuning dataset. Each record represents a single instruction-response pair with full provenance and classification metadata.",
  "type": "object",
  "required": [
    "instruction",
    "response",
    "metadata"
  ],
  "properties": {
    "instruction": {
      "type": "string",
      "minLength": 10,
      "maxLength": 2000,
      "description": "The question or prompt presented to the model during training."
    },
    "response": {
      "type": "string",
      "minLength": 50,
      "maxLength": 10000,
      "description": "The target response the model should learn to generate."
    },
    "metadata": {
      "type": "object",
      "required": [
        "id",
        "source",
        "classification",
        "provenance"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+/[a-z0-9-]+/[0-9]{3,}$",
          "description": "Unique identifier in format: source_type/category/index",
          "examples": [
            "synthetic/antisemitism/001",
            "prolewiki/imperialism/042",
            "curated/revisionism/007"
          ]
        },
        "source": {
          "$ref": "#/$defs/source"
        },
        "classification": {
          "$ref": "#/$defs/classification"
        },
        "citations": {
          "$ref": "#/$defs/citations"
        },
        "training": {
          "$ref": "#/$defs/training"
        },
        "provenance": {
          "$ref": "#/$defs/provenance"
        },
        "quality": {
          "$ref": "#/$defs/quality"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "source": {
      "type": "object",
      "description": "Where this Q&A pair originated from.",
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "prolewiki",
            "synthetic",
            "curated",
            "library",
            "external"
          ],
          "description": "The origin category of this training record."
        },
        "article": {
          "type": [
            "string",
            "null"
          ],
          "description": "ProleWiki article title if derived from corpus (e.g., 'Main/Imperialism')."
        },
        "work": {
          "type": [
            "string",
            "null"
          ],
          "description": "Title of source work for Library-derived Q&As."
        },
        "author": {
          "type": [
            "string",
            "null"
          ],
          "description": "Primary author of the source material."
        },
        "url": {
          "type": [
            "string",
            "null"
          ],
          "format": "uri",
          "description": "URL to original source if externally derived."
        },
        "chunk_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[A-Za-z]+/[^#]+#[0-9]+$"
          },
          "description": "ChromaDB chunk IDs this Q&A was derived from (links to RAG corpus)."
        }
      },
      "additionalProperties": false
    },
    "classification": {
      "type": "object",
      "description": "Theoretical and topical classification.",
      "required": [
        "categories",
        "tradition"
      ],
      "properties": {
        "categories": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 2
          },
          "minItems": 1,
          "uniqueItems": true,
          "description": "Topic tags (should align with ProleWiki categories where possible).",
          "examples": [
            [
              "imperialism",
              "revisionism"
            ],
            [
              "anti-zionism",
              "settler-colonialism",
              "national-liberation"
            ]
          ]
        },
        "tradition": {
          "type": "string",
          "enum": [
            "ML",
            "MLM",
            "general",
            "contested"
          ],
          "description": "Which Marxist tradition this represents. ML=Marxism-Leninism, MLM=Marxism-Leninism-Maoism, general=broadly applicable, contested=debated within ML circles."
        },
        "subtradition": {
          "type": [
            "string",
            "null"
          ],
          "description": "More specific tendency if applicable (e.g., 'Hoxhaist', 'Gonzaloite')."
        },
        "historical_period": {
          "type": [
            "string",
            "null"
          ],
          "description": "Historical period if the Q&A is period-specific.",
          "examples": [
            "Russian Revolution",
            "Cultural Revolution",
            "Cold War"
          ]
        },
        "geographic_focus": {
          "type": [
            "string",
            "null"
          ],
          "description": "Geographic region if the Q&A is region-specific.",
          "examples": [
            "Soviet Union",
            "China",
            "Palestine",
            "Global South"
          ]
        }
      },
      "additionalProperties": false
    },
    "citations": {
      "type": "object",
      "description": "Citation and reference tracking for the response.",
      "properties": {
        "has_citations": {
          "type": "boolean",
          "description": "Whether the response contains or references cited works."
        },
        "works": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/citedWork"
          },
          "description": "Works referenced in the response."
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "description": "Authors cited in the response (derived from works for quick filtering)."
        },
        "primary_sources": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Primary source documents directly quoted or referenced."
        }
      },
      "additionalProperties": false
    },
    "citedWork": {
      "type": "object",
      "description": "A work cited in the response.",
      "required": [
        "title",
        "author"
      ],
      "properties": {
        "title": {
          "type": "string",
          "description": "Title of the cited work."
        },
        "author": {
          "type": "string",
          "description": "Author of the cited work."
        },
        "year": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 1800,
          "maximum": 2030,
          "description": "Publication year."
        },
        "type": {
          "type": "string",
          "enum": [
            "book",
            "article",
            "speech",
            "letter",
            "pamphlet",
            "report",
            "interview",
            "documentary"
          ],
          "description": "Type of work."
        }
      },
      "additionalProperties": false
    },
    "training": {
      "type": "object",
      "description": "Training-specific metadata.",
      "properties": {
        "iteration": {
          "type": "integer",
          "minimum": 1,
          "description": "Which training iteration this record was added in."
        },
        "correction_for": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "cpc-contamination",
              "both-sidesing",
              "hallucination",
              "antisemitism-conflation",
              "liberal-framing",
              "historical-inaccuracy",
              "theoretical-error",
              "accommodation",
              "extended-engagement"
            ]
          },
          "description": "What failure modes this record is designed to correct."
        },
        "difficulty": {
          "type": "string",
          "enum": [
            "basic",
            "intermediate",
            "advanced",
            "adversarial"
          ],
          "description": "Difficulty level of the question."
        },
        "response_style": {
          "type": "string",
          "enum": [
            "educational",
            "firm-rejection",
            "theoretical",
            "historical",
            "biographical",
            "analytical",
            "comparative"
          ],
          "description": "The style/pattern of the response."
        },
        "adversarial_type": {
          "type": [
            "string",
            "null"
          ],
          "enum": [
            null,
            "bad-faith-question",
            "conspiracy-premise",
            "incremental-shift",
            "false-equivalence",
            "appeal-to-complexity"
          ],
          "description": "For adversarial questions, what type of adversarial pattern."
        }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "description": "Record creation and modification tracking.",
      "required": [
        "created_date",
        "created_by"
      ],
      "properties": {
        "created_date": {
          "type": "string",
          "format": "date",
          "description": "ISO 8601 date when this record was created."
        },
        "created_by": {
          "type": "string",
          "enum": [
            "human",
            "claude-opus",
            "claude-sonnet",
            "other-llm",
            "automated"
          ],
          "description": "Who/what created this record."
        },
        "reviewed_by": {
          "type": [
            "string",
            "null"
          ],
          "description": "Human reviewer if applicable."
        },
        "review_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date",
          "description": "Date of human review."
        },
        "modified_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date",
          "description": "Last modification date if edited after creation."
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Version number of this record (incremented on edits)."
        }
      },
      "additionalProperties": false
    },
    "quality": {
      "type": "object",
      "description": "Quality assessment metadata.",
      "properties": {
        "human_verified": {
          "type": "boolean",
          "description": "Whether a human has verified this Q&A for accuracy."
        },
        "confidence": {
          "type": "string",
          "enum": [
            "high",
            "medium",
            "low"
          ],
          "description": "Confidence level in the response accuracy."
        },
        "notes": {
          "type": [
            "string",
            "null"
          ],
          "description": "Any notes about quality issues or caveats."
        },
        "flagged_issues": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Known issues with this record that need attention."
        }
      },
      "additionalProperties": false
    }
  }
}
